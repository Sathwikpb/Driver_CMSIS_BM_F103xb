# STM32 ADC Triggered by PWM Edge

This project demonstrates the use of **ADC triggered by the positive edge of a PWM signal** using STM32. The ADC conversion is externally triggered by **Timer 1 Capture Compare 1 event**.

## Features
- **PWM Generation**: Configured using TIM1 with a prescaler of 32000 and a period of 10000.
- **ADC Triggering**: ADC1 is set to be triggered by **TIM1_CC1 event**.
- **UART Communication**: ADC values are transmitted via UART2.
- **Polling-based ADC Read**: Uses `HAL_ADC_PollForConversion` for reading ADC values.
- **Data Alignment**: ADC is configured for right alignment.

## Hardware Requirements
- **STM32F4xx Development Board**
- **UART Connection for Serial Debugging**
- **PWM Signal Output Pin** (Connected to an external circuit if needed)

## Software Requirements
- STM32CubeIDE / Keil / IAR Embedded Workbench
- STM32 HAL Library

## Configuration Details
### ADC Configuration
- **Trigger Source**: External trigger `ADC_EXTERNALTRIGCONV_T1_CC1`
- **Channel**: ADC_CHANNEL_1
- **Sampling Time**: 1.5 cycles
- **Conversion Mode**: Single conversion mode

### Timer 1 (PWM) Configuration
- **Prescaler**: 32000
- **Period**: 10000
- **PWM Mode**: TIM_OCMODE_PWM1
- **PWM Pulse**: 1000 (Initial duty cycle)
- **Clock Source**: Internal

### UART Configuration
- **Baud Rate**: 115200
- **Data Format**: 8N1 (8-bit data, No parity, 1 stop bit)

## How ADC is Triggered
The ADC is configured to start conversion on the **rising edge of the PWM signal** generated by TIM1. This is achieved by setting the ADC external trigger source to `TIM1_CC1`, which corresponds to the **Capture Compare 1 event of Timer 1**. The sequence of events is:

1. **PWM Generation**: TIM1 generates a PWM signal on its channel 1.
2. **Triggering Condition**: The ADC is set to trigger on the **rising edge of the PWM signal**.
3. **Conversion Start**: Each time the PWM signal transitions from LOW to HIGH, the ADC starts conversion automatically.
4. **Data Read**: The converted ADC value is retrieved and sent via UART.

### Note:
When an external trigger is selected for ADC regular or injected conversion, **only the rising edge of the signal can start the conversion**.

Conversion can be triggered by an external event (e.g. timer capture, EXTI line). If the EXTTRIG control bit is set, then external events are able to trigger a conversion. The EXTSEL[2:0] and JEXTSEL[2:0] control bits allow the application to select which out of 8 possible events can trigger conversion for the regular and injected groups.

This setup ensures that ADC sampling is synchronized with the PWM waveform, making it useful for time-sensitive applications.

### ADC External Trigger Source Selection
![image](https://github.com/user-attachments/assets/5193a83f-0412-4298-84a6-c5ee7e149edc)

### Timer and Duty Cycle Calculation
![image](https://github.com/user-attachments/assets/d8f2a62d-8b22-481b-83fc-ed33198270dc)

### Timer Trigger Event Selection as Update Event
![image](https://github.com/user-attachments/assets/b8a8824d-dc48-4653-a1b0-f76736ffae4b)

## Code Structure
- `MX_ADC1_Init()`: Initializes ADC with external trigger source.
- `MX_TIM1_Init()`: Initializes Timer 1 for PWM generation.
- `HAL_TIM_PWM_Start()`: Starts PWM generation on TIM1 channel 1.
- `HAL_ADC_PollForConversion()`: Waits for ADC conversion completion.
- `HAL_UART_Transmit()`: Sends ADC data via UART.

## How to Run
1. Flash the code to your STM32 board.
2. Open a serial terminal (115200 baud rate) to observe ADC values.
3. Adjust the PWM duty cycle to see ADC triggering behavior.

## Expected Output
The UART terminal should display ADC values:
```
ADC Value: 1234
ADC Value: 1357
ADC Value: 1402
```

## Future Enhancements
- Implement DMA-based ADC reading for better efficiency.
- Add an LCD or OLED display for real-time ADC value visualization.
- Optimize ADC sampling time for improved accuracy.

## License
This project is open-source and released under the MIT License.

